var autocomplete=[],bookingloc=[],numofvia=0,directionsDisplay,calculatedfare=0;var baserate=2.5,minfare=5,longmilestartsfrom=60;longmileagerate=2;var directionsService=new google.maps.DirectionsService;var myfavy=[];var myoldbookings=[];var activebookinghist=[];var activebooking=[];var telcust;var vehicleclass;var emailmevar;
function initialize(){autocomplete[0]=new google.maps.places.Autocomplete((document.getElementById("autocomplete")),{types:["geocode"]});autocomplete[1]=new google.maps.places.Autocomplete((document.getElementById("autocomplete1")),{types:["geocode"]});var len=autocomplete.length;for(var ik=0;ik<len;++ik){var s=autocomplete[ik];google.maps.event.addListener(s,"place_changed",function(){fillInAddress(this)})}directionsDisplay=new google.maps.DirectionsRenderer;if(window.sessionStorage.getlocationsessstore){document.getElementById("autocomplete").value=
JSON.parse(window.sessionStorage.getlocationsessstore);var popadd=JSON.parse(window.sessionStorage.getlocationsessstore);var poppost=JSON.parse(window.sessionStorage.postcodesessstore);var poplat=JSON.parse(window.sessionStorage.latsessstore);var poplon=JSON.parse(window.sessionStorage.lonsessstore);var accumulatorfrom=[];accumulatorfrom.push(popadd);accumulatorfrom.push(poppost);accumulatorfrom.push(poplat);accumulatorfrom.push(poplon);bookingloc[0]=accumulatorfrom}else initasaphidecalnclock();nomyoldbookings();
nofavy()}function viafieldbind(myvia){var myviaindex=myvia+1;var autoget="autocomplete"+myviaindex;autocomplete[myviaindex]=new google.maps.places.Autocomplete((document.getElementById(autoget)),{types:["geocode"]});var s1=autocomplete[myviaindex];google.maps.event.addListener(s1,"place_changed",function(){fillInAddress(this)})}
function fillInAddress(i){var accumulator=[];var j=autocomplete.indexOf(i);var place=i.getPlace();var address=place.formatted_address;var geocoder=new google.maps.Geocoder;geocoder.geocode({"address":address},function(results,status){if(status==google.maps.GeocoderStatus.OK){accumulator.push(results[0].geometry.location.k);accumulator.push(results[0].geometry.location.A)}else alert("Geocode was not successful for the following reason: "+status)});accumulator.push(place.formatted_address);accumulator.push(place.address_components[5].long_name);
bookingloc[j]=accumulator;calcRoute()}function geolocate(){if(navigator.geolocation)navigator.geolocation.getCurrentPosition(function(position){var geolocation=new google.maps.LatLng(position.coords.latitude,position.coords.longitude);autocomplete[0].setBounds(new google.maps.LatLngBounds(geolocation,geolocation))})}
function addElement(){numofvia=numofvia+1;var contentID=document.getElementById("content");var newTBDiv=document.createElement("div");var autonumofvia=numofvia+1;newTBDiv.setAttribute("id","strText"+numofvia);newTBDiv.innerHTML="Via "+numofvia+": <input type='text' id='autocomplete"+autonumofvia+"' name='"+autonumofvia+"'/ >";contentID.appendChild(newTBDiv);viafieldbind(numofvia)}
function removeElement(){if(numofvia!==0){var autonumofviar=numofvia;var autogetr="strText"+autonumofviar;var elem=document.getElementById(autogetr);elem.parentNode.removeChild(elem);numofvia=numofvia-1}}function sessionsave(sess2save){var sessionToStore=JSON.stringify(sess2save);if(typeof Storage!="undefined")window.sessionStorage.setItem("sessionkey",sessionToStore);else document.getElementById("result").innerHTML="Sorry,  your browser does not support Web Storage..."}
function localstoragesave(data2save){var dataToStore=JSON.stringify(data2save);if(typeof Storage!="undefined")window.localStorage.setItem("melocalstore",dataToStore);else document.getElementById("result").innerHTML="Sorry,  your browser does not support Web Storage..."}
function calcRoute(){if(typeof bookingloc[0]=="undefined"){document.getElementById("total").innerHTML="";return}if(typeof bookingloc[1]=="undefined"){document.getElementById("total").innerHTML="";return}var start=bookingloc[0][0];var end=bookingloc[1][0];var waypts=[];for(var ki=0;ki<numofvia;ki++){var viaindexinbook=ki+2;waypts.push({location:bookingloc[viaindexinbook][0],stopover:true})}var request={origin:start,destination:end,waypoints:waypts,optimizeWaypoints:true,travelMode:google.maps.TravelMode.DRIVING};
directionsService.route(request,function(response,status){if(status==google.maps.DirectionsStatus.OK){directionsDisplay.setDirections(response);computeTotalDistance(directionsDisplay.getDirections());bookingsavetolocalstorage()}})}
function computeTotalDistance(result){var total=0,resultr=0;var myroute=result.routes[0];for(var ic=0;ic<myroute.legs.length;ic++)total+=myroute.legs[ic].distance.value;total=total/1E3;total=total*.62;resultr=total.toFixed(1);var costofjourney=resultr*baserate;if(resultr>longmilestartsfrom)costofjourney=resultr*longmileagerate;if(costofjourney<minfare)costofjourney=minfare;var costofestate=costofjourney+5;var costofmpv=costofjourney*1.5;var costofexecutive=costofjourney*1.8;var Costofwaitnreturn=
costofjourney*1.5;var optionval=document.getElementById("vehicletype").selectedIndex;var istringval="";vehicleclass=optionval;switch(optionval){case 0:istringval="Cost is "+costofjourney.toFixed(2);calculatedfare=costofjourney.toFixed(2);break;case 1:istringval="Cost is "+costofestate.toFixed(2);calculatedfare=costofestate.toFixed(2);break;case 2:istringval="Cost is "+costofexecutive.toFixed(2);calculatedfare=costofexecutive.toFixed(2);break;case 3:istringval="Cost is "+costofmpv.toFixed(2);calculatedfare=
costofmpv.toFixed(2);break;default:}document.getElementById("total").innerHTML=istringval}function mylocation(){window.location.href="map.html"}function favtolocalstorage(){if(window.localStorage.fav){myfavy=JSON.parse(window.localStorage.fav);myfavy=removedupinarray(myfavy)}myfavy.push(bookingloc[1]);var myfavyj1=JSON.stringify(myfavy);window.localStorage.setItem("fav",myfavyj1)}
function favfromlocalstorage(){if(window.localStorage.fav)myfavy=JSON.parse(window.localStorage.fav);myfavy.push(bookingloc[0]);myfavy=removedupinarray(myfavy);var myfavyj=JSON.stringify(myfavy);window.localStorage.setItem("fav",myfavyj)}
function populatefavsto(){var select=document.getElementById("GetFavouritebackto");if(select.length>0){if(window.localStorage.fav)myfavy=JSON.parse(window.localStorage.fav);myfavy=removedupinarray(myfavy);while(select.firstElementChild)select.removeChild(select.firstElementChild);var optionsupdate=[];for(var id=0;id<myfavy.length;id++){optionsupdate[id]=myfavy[id][0];var optupdate=optionsupdate[id];var elupdate=document.createElement("option");elupdate.textContent=optupdate;elupdate.value=optupdate;
select.appendChild(elupdate)}}if(select.length===0){if(window.localStorage.fav)myfavy=JSON.parse(window.localStorage.fav);myfavy=removedupinarray(myfavy);var options=[];for(var ie=0;ie<myfavy.length;ie++){options[ie]=myfavy[ie][0];var opt=options[ie];var el=document.createElement("option");el.textContent=opt;el.value=opt;select.appendChild(el)}}}
function selectfavputinto(){var select=document.getElementById("GetFavouritebackto");var fbto=select.selectedIndex;bookingloc[1]=myfavy[fbto];document.getElementById("autocomplete1").value=myfavy[fbto][0];calcRoute()}
function populatefavsfrom(){var select=document.getElementById("GetFavouritebackfrom");if(select.length>0){if(window.localStorage.fav)myfavy=JSON.parse(window.localStorage.fav);myfavy=removedupinarray(myfavy);while(select.firstElementChild)select.removeChild(select.firstElementChild);var optionsupdate=[];for(var ig=0;ig<myfavy.length;ig++){optionsupdate[ig]=myfavy[ig][0];var optupdate=optionsupdate[ig];var elupdate=document.createElement("option");elupdate.textContent=optupdate;elupdate.value=optupdate;
select.appendChild(elupdate)}}if(select.length===0){if(window.localStorage.fav)myfavy=JSON.parse(window.localStorage.fav);myfavy=removedupinarray(myfavy);var options=[];for(var ih=0;ih<myfavy.length;ih++){options[ih]=myfavy[ih][0];var opt=options[ih];var el=document.createElement("option");el.textContent=opt;el.value=opt;select.appendChild(el)}}}
function selectfavputinfrom(){var select=document.getElementById("GetFavouritebackfrom");var fbto=select.selectedIndex;bookingloc[0]=myfavy[fbto];document.getElementById("autocomplete").value=myfavy[fbto][0];calcRoute()}function delfavfromlocalstorageto(){var select=document.getElementById("GetFavouritebackto");var fbto=select.selectedIndex;select.remove(fbto);myfavy.splice(fbto,1);var myfavyj=JSON.stringify(myfavy);window.localStorage.setItem("fav",myfavyj)}
function delfavfromlocalstoragefrom(){var select=document.getElementById("GetFavouritebackfrom");var fbto=select.selectedIndex;select.remove(fbto);myfavy.splice(fbto,1);var myfavyj=JSON.stringify(myfavy);window.localStorage.setItem("fav",myfavyj)}
function bookingsavetolocalstorage(){if(window.localStorage.bookhist)myoldbookings=JSON.parse(window.localStorage.bookhist);myoldbookings.push(bookingloc);myoldbookings=removedupinarray(myoldbookings);var myoldbookings1=JSON.stringify(myoldbookings);window.localStorage.setItem("bookhist",myoldbookings1)}
function myRepeatBooking(){var select=document.getElementById("GetRepeatBooking");if(select.length>0){if(window.localStorage.bookhist)myoldbookings=JSON.parse(window.localStorage.bookhist);myoldbookings=removedupinarray(myoldbookings);while(select.firstElementChild)select.removeChild(select.firstElementChild);var optionsupdate=[];for(var ii=0;ii<myoldbookings.length;ii++){optionsupdate[ii]=myoldbookings[ii][0];var optupdate=optionsupdate[ii];var elupdate=document.createElement("option");elupdate.textContent=
optupdate;elupdate.value=optupdate;select.appendChild(elupdate)}}if(select.length===0){if(window.localStorage.bookhist)myoldbookings=JSON.parse(window.localStorage.bookhist);var options=[];for(var ij=0;ij<myoldbookings.length;ij++){options[ij]=myoldbookings[ij];var opt=options[ij][0][0]+options[ij][1][0];var el=document.createElement("option");el.textContent=opt;el.value=opt;select.appendChild(el)}}}
function selectbookingintonfrom(){var select=document.getElementById("GetRepeatBooking");var fbto=select.selectedIndex;bookingloc=myoldbookings[fbto];document.getElementById("autocomplete").value=bookingloc[0][0];document.getElementById("autocomplete1").value=bookingloc[1][0];if(numofvia)for(var ia=0;ia<numofvia;ia++)removeElement();var numofviaregen=bookingloc.length-2;if(numofviaregen)for(var ib=0;ib<numofviaregen;ib++){addElement();var j=ib+2;var meid="autocomplete"+j;document.getElementById(meid).value=
bookingloc[j][0]}calcRoute()}
function cleanup(){telcust=document.getElementById("telme").value;emailmevar=document.getElementById("emailme").value;if(telcust==""){alert("please put your contact");return}if(calculatedfare==0){alert("please calculate fare");return}var asapjob;var currentdatetime=Date();var currentdatetimeparse=Date.parse(Date());asapjob=document.getElementById("myCheck").checked;if(asapjob)activebooking.push(currentdatetimeparse);else{var usertime=document.getElementById("metime").value;if(usertime==""){alert("please set time");
return}var userdate=document.getElementById("medate").value;if(userdate==""){alert("please set date");return}var combinedatentime=userdate+" "+usertime;if(bookingloc[0]==bookingloc[1])alert("origin cannot be same as destination");var vmedate=Date.parse(combinedatentime);var vnowdate=Date.parse(Date());var datediff=vmedate-vnowdate;if(datediff<0){alert("past date n time bookings not allowed");return}activebooking.push(vmedate);activebooking.push(vmedate);activebooking.push(bookingloc);activebooking.push(calculatedfare)}activebooking.push(telcust);
activebooking.push(emailmevar);activebooking.push(bookingloc);activebooking.push(calculatedfare);activebooking.push(vehicleclass);if(window.localStorage.activebookingls)activebookinghist=JSON.parse(window.localStorage.activebookingls);activebookinghist.push(activebooking);var activebookinghist1=JSON.stringify(activebookinghist);window.localStorage.setItem("activebookingls",activebookinghist1)}
function asaphidemanual(){if(document.getElementById("myCheck").checked){document.getElementById("medate").style.display="none";document.getElementById("metime").style.display="none"}else{document.getElementById("medate").style.display="";document.getElementById("metime").style.display=""}}function initasaphidecalnclock(){document.getElementById("myCheck").checked=true;document.getElementById("medate").style.display="none";document.getElementById("metime").style.display="none"}
function myreturnfn(){if(document.getElementById("myreturn").checked){bookingloc.reverse();document.getElementById("autocomplete").value=bookingloc[0][0];document.getElementById("autocomplete1").value=bookingloc[1][0];if(numofvia)for(var ia=0;ia<numofvia;ia++)removeElement();var numofviaregen=bookingloc.length-2;if(numofviaregen)for(var ib=0;ib<numofviaregen;ib++){addElement();var j=ib+2;var meid="autocomplete"+j;document.getElementById(meid).value=bookingloc[j][0]}}}
function removedupinarray(iarr){var o={},i,l=iarr.length,r=[];for(i=0;i<l;i+=1)o[iarr[i]]=iarr[i];for(i in o)r.push(o[i]);return r}
function nofavy(){if(typeof window.localStorage.fav=="undefined"){document.getElementById("gff").style.display="none";document.getElementById("GetFavouritebackfrom").style.display="none";document.getElementById("dff").style.display="none";document.getElementById("gft").style.display="none";document.getElementById("GetFavouritebackto").style.display="none";document.getElementById("dft").style.display="none";return}if(window.localStorage.fav.length==0){document.getElementById("gff").style.display="none";
document.getElementById("GetFavouritebackfrom").style.display="none";document.getElementById("dff").style.display="none";document.getElementById("gft").style.display="none";document.getElementById("GetFavouritebackto").style.display="none";document.getElementById("dft").style.display="none"}else{document.getElementById("gff").style.display="";document.getElementById("GetFavouritebackfrom").style.display="";document.getElementById("dff").style.display="";document.getElementById("gft").style.display=
"";document.getElementById("GetFavouritebackto").style.display="";document.getElementById("dft").style.display=""}}
function nomyoldbookings(){if(typeof window.localStorage.bookhist=="undefined"){document.getElementById("repeatbk").style.display="none";document.getElementById("GetRepeatBooking").style.display="none";return}if(window.localStorage.bookhist.length==0){document.getElementById("repeatbk").style.display="none";document.getElementById("GetRepeatBooking").style.display="none"}else{document.getElementById("repeatbk").style.display="";document.getElementById("GetRepeatBooking").style.display=""}};
